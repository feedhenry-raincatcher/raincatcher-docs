[id='{context}-pro-keycloak-enablement']
= Enabling {WFM-RC-KeycloakName}

This section includes:

NOTE: Steps 3 and 4 are valid for any instance of *{WFM-RC-KeycloakName}* provided you implement the _Realm settings_.

. xref:{context}-run-keycloak-docker-image[Running the {WFM-RC-KeycloakName} Docker Image]
. xref:{context}-adding-keycloak-configuration[Importing the {WFM-RC-KeycloakName} Realm Settings]
. xref:{context}-adding-keycloak-configuration[Adding {WFM-RC-KeycloakName} Configuration]
. xref:{context}-enabling-keycloak-on-the-demo-server[Enabling {WFM-RC-KeycloakName} on the Demo Server]
. xref:{context}-accessing-the-keycloak-admin-console[Accessing the {WFM-RC-KeycloakName} Admin Console]

IMPORTANT: Enabling *{WFM-RC-KeycloakName}* requires the disabling of *PassportAuth*.

ifdef::upstream[]
discrete
endif::upstream[]
== Prerequisites

. Ensure you have completed xref:getting-started[Getting Started]
. Docker (tested with version: {WFM-RC-DockerVersion})

[id='{context}-run-keycloak-docker-image']
[discrete]
== Running the {WFM-RC-KeycloakName} Docker Image

. Open a terminal and run the *{WFM-RC-KeycloakName}* Docker image

[source,bash]
----
docker run -p 8080:8080 feedhenry/raincatcher-keycloak
----

For more information about the *{WFM-RC-KeycloakName}* Docker Image, see the *{WFM-RC-KeycloakName}* link:{WFM-RC-KeycloakDockerURL}{WFM-RC-Branch}/README.md[README.md].

[id={context}-adding-keycloak-configuration]
[discrete]
== Adding {WFM-RC-KeycloakName} Configuration

. Choose which _configuration file_ to edit:
+
.*{WFM-RC-KeycloakName}* Configuration File
|===
|Area |File Name | File Location

|Development
|link:{WFM-RC-CoreURL}{WFM-RC-Branch}/demo/server/config-dev.json[config-dev.json]
|/demo/server/config-dev.json

|Production
|link:{WFM-RC-CoreURL}{WFM-RC-Branch}/demo/server/config-prod.json[config-prod.json]
|/demo/server/config-prod.json

|===
+
NOTE: The `keycloakConfig` field is partially implemented in link:{WFM-RC-CoreURL}{WFM-RC-Branch}/demo/server/config-prod.json[config-prod.json].
+
. Open the _configuration file_, create a new field called `keycloakConfig` and add the following data to `keycloakConfig`:
+
[source,javascript]
----
"keycloakConfig":{
                    "realm": "raincatcher",
                    "bearer-only": true,
                    "auth-server-url": "http://localhost:8080/auth",
                    "ssl-required": "external",
                    "resource": "raincatcher-cloud",
                    "use-resource-role-mappings": true
                  }
----


[id={context}-enabling-keycloak-on-the-demo-server]
[discrete]
== Enabling {WFM-RC-KeycloakName} on the Demo Server

. Open the file link:{WFM-RC-AngularJsURL}{WFM-RC-Branch}/demo/mobile/src/app/app.js[app.js] in location _/demo/mobile/src/app/_ and change the contents to:
+
[source,javascript]
----
    // Comment to disable passport auth
    require('@raincatcher/demo-auth-passport')('wfm-mobile'),
    // Uncomment to enable Keycloak
    // require('../keycloak');
----
+
. Open the file link:{WFM-RC-AngularJsURL}{WFM-RC-Branch}/demo/portal/src/app/main.js[main.js] in location _/demo/portal/src/app/_ and change the contents to:
+
[source,javascript]
----
    // Comment to disable passport auth
    require('@raincatcher/demo-auth-passport')('app'),
    // Uncomment to enable Keycloak
    // require('./keycloak');
----
+
. At this point, the _Routes_ are protected by *{WFM-RC-KeycloakName}*.

[id={context}-accessing-the-keycloak-admin-console]
[discrete]
== Accessing the {WFM-RC-KeycloakName} Admin Console

. To access the _{WFM-RC-KeycloakName} Admin Console_, navigate to _http://localhost:8080/auth/_
